% document class options for Amazon's paperback
\documentclass[12pt,oneside,openright]{book}

\usepackage{iftex}

% --- LOAD FONT SELECTION AND ENCODING BEFORE LOADING LWARP ---

\ifPDFTeX
\usepackage{lmodern}            % pdflatex or dvi latex
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\else
\usepackage{fontspec}           % XeLaTeX or LuaLaTeX
\fi

% --- LWARP IS LOADED NEXT ---
\usepackage[
%   HomeHTMLFilename=index,     % Filename of the homepage.
%   HTMLFilename={node-},       % Filename prefix of other pages.
%   IndexLanguage=english,      % Language for xindy index, glossary.
%   latexmk,                    % Use latexmk to compile.
%   OSWindows,                  % Force Windows. (Usually automatic.)
%   mathjax,                    % Use MathJax to display math.
]{lwarp}
% \boolfalse{FileSectionNames}  % If false, numbers the files.

% --- LOAD PDFLATEX MATH FONTS HERE ---

% --- OTHER PACKAGES ARE LOADED AFTER LWARP ---

% geometry for Amazon paperback
\usepackage[
    left=0.5in,
    right=0.5in,
    top=0.75in,
    bottom=1.0in,
    paperwidth=8.25in,
    paperheight=11in,
    bindingoffset=0.375in
]{geometry}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{cmap} % Improves copy-paste functionality
\usepackage{alltt}
\usepackage{fancyvrb}

\usepackage[pdftex]{graphicx}

\usepackage{tikz}
%\usetikzlibrary {arrows.meta,graphs,graphdrawing}
%\usegdlibrary{layered}
%\usegdlibrary{trees}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{arrows.meta}

\usepackage{fancyhdr}
\setlength{\headheight}{19pt} % because the logo uses more space than usual

\newcommand{\myincludegraphics}[2]{\includegraphics[width={#1}]{"tutorial-images/#2"}}
\newcommand{\inputCommand}[1]{\input{../../src/main/latex/generated/#1_command}}
\newcommand{\inputOutput}[1]{\input{../../src/main/latex/generated/#1_output}}

\pagestyle{fancy}

\fancyhf{}%
%\renewcommand{\headrulewidth}{1pt}
\fancyhead[L]{\myincludegraphics{1.5cm}{hotmoka_logo}}
\fancyhead[R]{Chapter~\thechapter}
\fancyfoot[L]{}
\fancyfoot[C]{\thepage}
\fancyfoot[R]{}

\usepackage{makeidx} \makeindex
\usepackage{xcolor}
\usepackage{hyperref,cleveref}  % LOAD THESE LAST!
\usepackage{url}
\DeclareUrlCommand\email{\urlstyle{tt}}
\DeclareUrlCommand\website{\urlstyle{same}}
\DeclareUrlCommand\directory{\urlstyle{same}}
\usepackage{mdframed}
\usepackage{caption}
\usepackage{subcaption}

% --- DOCUMENT PARAMETERS ---

\input{../../src/main/latex/generated/parameters}
\input{../../src/main/latex/generated/parameters_mokamint}
\input{../../src/main/latex/generated/parameters_tendermint}
\input{../../src/main/latex/generated/parameters_quantum_mokamint}

% --- LATEX AND HTML CUSTOMIZATION ---
\title{Programming Hotmoka\\{\small A tutorial on Hotmoka and smart contracts in Takamaka}}
\author{Fausto Spoto (\faustoEmail{})}
\date{\today\\{\small (updated to Hotmoka \hotmokaVersion{}, Mokamint \mokamintVersion{} and Takamaka \takamakaVersion{})} \\
  \vspace*{10ex}
  \hotmokaWeb{} \\
  \vspace*{30ex}
  {\small\begin{minipage}{\textwidth*4/5}
    \begin{center}\myincludegraphics{11ex}{CC_license}\end{center}
    This document is licensed under a Creative Commons Attribution 4.0 International License.
    Its latest version is available for free in various formats at \hotmokaRepoReleases{}.
  \end{minipage}}
}
\setcounter{tocdepth}{2}        % Include subsections in the \TOC.
\setcounter{secnumdepth}{2}     % Number down to subsections.
\setcounter{FileDepth}{1}       % Split \HTML\ files at sections
\booltrue{CombineHigherDepths}  % Combine parts/chapters/sections
\setcounter{SideTOCDepth}{2}    % Include subsections in the side\TOC
\HTMLTitle{Programming Hotmoka} % Overrides \title for the web page.
\HTMLAuthor{Fausto Spoto}       % Sets the HTML meta author tag.
\HTMLLanguage{en-US}            % Sets the HTML meta language.
\HTMLDescription{A tutorial on Hotmoka and smart contracts in Takamaka} % Sets the HTML meta description.
\HTMLFirstPageTop{\begin{center}\myincludegraphics{10cm}{hotmoka_logo}\end{center}}
\HTMLPageTop{\begin{center}\myincludegraphics{7cm}{hotmoka_logo}\end{center}}
\HTMLPageBottom{Copyright 2022 by Fausto Spoto (\faustoEmail{})}
\CSSFilename{lwarp_sagebrush.css}

\definecolor{objectbackgroundcolor}{rgb}{1,0.6,0.7}
\definecolor{jarbackgroundcolor}{rgb}{0.9,0.9,0.3}
\definecolor{statebackgroundcolor}{rgb}{0.6,0.6,1.0}

\definecolor{commentboxbackgroundcolor}{rgb}{0.9,0.85,1.0}
\newmdenv[linecolor=black,leftmargin=1em,rightmargin=1em,innertopmargin=1em,innerbottommargin=1em,backgroundcolor={commentboxbackgroundcolor}]{commentbox}

\definecolor{shellboxbackgroundcolor}{rgb}{0.8,1.0,0.8}
\newmdenv[linecolor=black,leftmargin=1em,rightmargin=1em,backgroundcolor={shellboxbackgroundcolor}]{shellbox}

\definecolor{shellcommandboxbackgroundcolor}{rgb}{1.0,0.9,0.9}
\newmdenv[linecolor=black,leftmargin=1em,rightmargin=1em,backgroundcolor={shellcommandboxbackgroundcolor}]{shellcommandbox}

\definecolor{codeboxbackgroundcolor}{rgb}{0.9,0.9,0.9}
\newmdenv[linecolor=black,leftmargin=1em,rightmargin=1em,backgroundcolor={codeboxbackgroundcolor}]{codebox}

\usepackage{listings} 

\lstset{% 
  basicstyle=\ttfamily\small, 
  breaklines=true,
  columns=fullflexible,
  %escapeinside = {ยง}{ยง},
  breakindent=0pt} 
\lstnewenvironment{ttlst}{}{} 

\lstdefinestyle{myJava}{
tabsize = 2, %% set tab space width
showstringspaces = false, %% prevent space marking in strings, string is defined as the text that is generally printed directly to the console
%numbers = left, %% display line numbers on the left
commentstyle = \color{violet}, %% set comment color
keywordstyle = \color{blue}, %% set keyword color
stringstyle = \color{red}, %% set string color
rulecolor = \color{black}, %% set frame color to avoid being affected by text color
basicstyle = \small \ttfamily , %% set listing font and size
breaklines = true, %% enable line breaking
%numberstyle = \tiny,
%escapeinside = ||,
language = Java,
showstringspaces=false,
morekeywords={module,requires,exports,provides}
%frame = trBL,
%firstnumber = last
}

\lstnewenvironment{javalst}[1][]{
  \lstset{style=myJava, #1} % Apply the style and any extra options
}{}

\lstdefinestyle{myXML}{
  language=XML,
  escapeinside = ||,
  tabsize = 2, %% set tab space width
  showstringspaces=false,
  commentstyle = \color{violet}, %% set comment color
  keywordstyle = \color{blue}, %% set keyword color
  stringstyle = \color{red}, %% set string color
  rulecolor = \color{black}, %% set frame color to avoid being affected by text color
  basicstyle = \small \ttfamily , %% set listing font and size
  morekeywords={encoding,project,modelVersion,groupId,artifactId,properties,dependencies,dependency,build,plugins,plugin,maven,compiler,release,sourceEncoding,xs:schema,xs:element,xs:complexType,xs:sequence,xs:attribute}
}

\lstnewenvironment{xmllst}[1][]{
  \lstset{style=myXML, #1} % Apply the style and any extra options
}{}

\newcommand{\ie}{\emph{i.e.}\@}
\newcommand{\wrt}{\emph{wrt.}\@}
\newcommand{\leftplug}{\myincludegraphics{0.7cm}{plug_left}}
\newcommand{\rightplug}{\myincludegraphics{0.7cm}{plug_right}}
\newcommand{\ssd}{\myincludegraphics{0.8cm}{ssd}}

\colorlet{lightred}{red!50!white}
\colorlet{lightviolet}{violet!50!white}
\colorlet{verylightgray}{gray!25!white}

\begin{document}

\maketitle                      % Or titlepage/titlingpage environment.

% An article abstract would go here.

\tableofcontents                % MUST BE BEFORE THE FIRST SECTION BREAK!
%\listoffigures

\input{1 introduction}
\input{2 getting_started}
\input{3 first_takamaka_program}
\input{4 smart_contracts}
\input{5 support_library}
\input{6 tokens}
\input{7 blockchains}
\input{8 nodes}
\input{9 code_verification}

\bibliographystyle{plain}

\begin{warpprint}   % For print output ...
\cleardoublepage    % ... a common method to place index entry into TOC.
\phantomsection
\addcontentsline{toc}{chapter}{\indexname}
\printindex
\cleardoublepage    % ... a common method to place bibliography entry into TOC.
\phantomsection
\addcontentsline{toc}{chapter}{Bibliography}
\end{warpprint}

\begin{warpHTML}
\ForceHTMLPage      % HTML index will be on its own page.
\ForceHTMLTOC       % HTML index will have its own toc entry.
\printindex
\ForceHTMLPage      % HTML bibliography will be on its own page.
\ForceHTMLTOC       % HTML bibliography will have its own toc entry.
\end{warpHTML}

\bibliography{../../src/main/latex/biblio}

\end{document}
